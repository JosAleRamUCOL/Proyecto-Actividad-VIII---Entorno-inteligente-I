<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión - Joystick MQTT Controller</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/main/style.css">
    <link rel="stylesheet" href="/gestion/style.css">
</head>
<body>
    <!-- Menú de navegación superior -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-logo">Sistema EITD</div>
            <ul class="nav-menu">
              <li><a href="/success" class="nav-link">Inicio</a></li>
              <li><a href="/basedatos" class="nav-link">Base de datos</a></li>
              <li><a href="/monitoreo" class="nav-link">Monitoreo</a></li>
              <li><a href="/gestion" class="nav-link active">Gestión</a></li>
            </ul>
        </div>
    </nav>

    <div class="controller">
        <div class="controller-header">
            <h2>Controlador MQTT</h2>
            <p class="controller-subtitle">Control remoto mediante MQTT</p>
        </div>
        
        <div class="connection-section">
            <input type="text" id="topicInput" placeholder="Tema MQTT (ej: carro/control)" value="carro/control">
            <button id="connectBtn" class="btn-connect">Conectar al Broker</button>
            <div id="connectionStatus" class="status-disconnected">● Desconectado</div>
        </div>
        
        <!-- Pestañas para alternar entre Joystick, Mapa y Seguimiento de Línea -->
        <div class="tabs-container">
            <button class="tab active" data-tab="joystick-tab">Control Joystick</button>
            <button class="tab" data-tab="map-tab">Selección de Ubicación</button>
            <button class="tab" data-tab="line-tracking-tab">Seguimiento de Línea</button>
        </div>
        
        <!-- Contenido de la pestaña Joystick -->
        <div id="joystick-tab" class="tab-content active">
            <div class="joystick-container">
                <h3>Control</h3>
                <div id="joystick">
                    <div id="joystickKnob"></div>
                </div>
                <p class="joystick-help">Arrastra el joystick para controlar la dirección</p>
            </div>
        </div>
        
        <!-- Contenido de la pestaña Mapa -->
        <div id="map-tab" class="tab-content">
            <div class="map-section">
                <h3>Selección de Ubicación</h3>
                <div class="map-container">
                    <div id="map"></div>
                    <div class="location-info">
                        <h4>Información de Ubicación</h4>
                        <p><strong>Latitud:</strong> <span id="lat">-</span></p>
                        <p><strong>Longitud:</strong> <span id="lng">-</span></p>
                        <p><strong>Hora GMT:</strong> <span id="gmtTime">-</span></p>
                        <p><strong>Fecha:</strong> <span id="date">-</span></p>
                        <p><strong>Orientación (grados):</strong> <span id="orientation">-</span></p>
                        <button id="sendLocation" class="btn-send">Enviar Ubicación por MQTT</button>
                    </div>
                </div>
                <p class="joystick-help">Arrastra el marcador en el mapa para seleccionar una ubicación</p>
            </div>
        </div>
        
        <!-- Contenido de la pestaña Seguimiento de Línea -->
        <div id="line-tracking-tab" class="tab-content">
            <div class="line-tracking-container">
                <h3>Seguimiento de Línea</h3>
                <div class="tracking-toggle">
                    <span class="toggle-label">Seguimiento de Línea:</span>
                    <button id="lineTrackingToggle" class="toggle-btn"></button>
                </div>
                <div id="trackingStatus" class="toggle-status status-off">DESACTIVADO</div>
                <p class="joystick-help">Activa o desactiva el modo de seguimiento de línea</p>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/gestion/script_gestion.js"></script>
</body>
</html>